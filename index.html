<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecurCorp Intelligence Report</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

    <style>
        :root {
            --bg-body: #0b1120;       /* Deepest Dark Blue */
            --bg-card: #1e293b;       /* Card Background */
            --text-main: #f1f5f9;     /* White/Gray text */
            --text-muted: #94a3b8;    /* Muted text */
            --accent: #38bdf8;        /* Neon Cyan */
            --danger: #ef4444;        /* Red */
            --grid-line: #334155;     /* Dark grid lines */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            line-height: 1.6;
            overflow-x: hidden; /* Prevent horizontal scrollbar issues */
        }

        /* --- HERO SECTION --- */
        header {
            min-height: 90vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            background: radial-gradient(circle at 50% 50%, #1e293b 0%, #0b1120 100%);
            padding: 20px;
            border-bottom: 1px solid var(--grid-line);
        }

        h1 { 
            font-size: clamp(2.5rem, 5vw, 4.5rem); /* Responsive font size */
            font-weight: 800; 
            margin-bottom: 10px; 
            letter-spacing: -2px;
            background: -webkit-linear-gradient(0deg, #fff, #94a3b8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .subtitle { font-size: 1.2rem; color: var(--text-muted); max-width: 600px; margin-bottom: 50px; }

        /* KPI Cards */
        .hero-kpi {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            width: 100%;
            max-width: 1000px;
        }

        .kpi-card {
            background: rgba(30, 41, 59, 0.4); /* Glass effect */
            border: 1px solid rgba(255,255,255,0.05);
            padding: 25px;
            border-radius: 16px;
            backdrop-filter: blur(10px);
        }
        
        .kpi-val { font-size: 2.5rem; font-weight: 700; color: #fff; margin-bottom: 5px; }
        .kpi-lbl { text-transform: uppercase; font-size: 0.75rem; letter-spacing: 1px; color: var(--accent); }

        /* --- STORY SECTIONS --- */
        .story-section {
            width: 90%;
            max-width: 1600px; /* Wider layout */
            margin: 100px auto;
        }

        .section-title {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--text-main);
            border-left: 4px solid var(--accent);
            padding-left: 20px;
        }
        
        .section-desc {
            font-size: 1.1rem;
            color: var(--text-muted);
            margin-bottom: 30px;
            padding-left: 20px;
            max-width: 800px;
        }

        /* --- VIZ CONTAINER (DARK MODE) --- */
        .viz-wrapper {
            background: var(--bg-card);
            border: 1px solid var(--grid-line);
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }

        /* Remove default Vega actions link placement issue */
        .vega-actions { display: none; }

        /* Code Block */
        .code-display {
            background: #000;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: #10b981; /* Hacker Green */
            overflow-x: auto;
        }

        /* Scroll Hint */
        .scroll-down {
            margin-top: 60px;
            font-size: 2rem;
            color: var(--text-muted);
            animation: float 2s infinite ease-in-out;
            cursor: pointer;
        }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(10px); } }

        /* Footer */
        footer {
            padding: 40px;
            text-align: center;
            color: var(--text-muted);
            font-size: 0.9rem;
            border-top: 1px solid var(--grid-line);
        }

    </style>
</head>
<body>

    <header>
        <h1>SecurCorp <span>Intelligence</span></h1>
        <p class="subtitle">Globális Kiberbiztonsági Kockázatelemzés és Trendek</p>
        
        <div class="hero-kpi">
            <div class="kpi-card">
                <div class="kpi-val">1,240</div>
                <div class="kpi-lbl">Incidens / Év</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-val" style="color: var(--danger);">$2.4M</div>
                <div class="kpi-lbl">Becsült Kár</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-val" style="color: var(--accent);">Finance</div>
                <div class="kpi-lbl">Legtöbb Kockázat</div>
            </div>
        </div>

        <div class="scroll-down">↓</div>
    </header>

    <section class="story-section">
        <h2 class="section-title">1. A Kockázati Mátrix</h2>
        <p class="section-desc">
            Interaktív elemzés: A lenti diagramok <strong>össze vannak kötve</strong>. 
            Jelöljön ki egy időszakot a felső (Scatter) diagramon az egérrel (húzás), 
            és figyelje meg, hogyan változnak az alsó adatok!
        </p>
        
        <div class="viz-wrapper" id="viz-main"></div>
    </section>

    <section class="story-section" style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px; align-items: start;">
        <div>
            <h2 class="section-title" style="border-color: var(--danger);">2. Támadói Mintázatok</h2>
            <p class="section-desc">
                Mikor vagyunk a legsebezhetőbbek?
                <br><br>
                A <strong>Hőtérkép (Heatmap)</strong> megmutatja a támadások intenzitását napokra és órákra bontva. 
                Jól látható a sötétebb zóna a munkaidőben (09:00 - 17:00), ami célzott, humán eredetű támadásokra utal.
            </p>
            <div class="code-display">
// JSON Adatpont Minta
{
  "date": "2023-11-04",
  "day": "Wednesday",
  "hour": 14,
  "type": "Phishing",
  "dept": "Finance"
}
            </div>
        </div>
        <div class="viz-wrapper" id="viz-heatmap"></div>
    </section>

    <footer>
        SecurCorp Analytics • Business Intelligence Project • Week 10 Integration
    </footer>

    <script type="text/javascript">
        
        // --- 1. ADATGENERÁLÁS ---
        const dataPoints = [];
        const depts = ['IT', 'HR', 'Finance', 'Sales', 'Marketing'];
        const types = ['Phishing', 'Malware', 'DDoS', 'Ransomware', 'Social Eng'];
        const days = ['Hétfő', 'Kedd', 'Szerda', 'Csütörtök', 'Péntek', 'Szombat', 'Vasárnap'];

        for(let i=0; i<1000; i++) {
            const m = Math.floor(Math.random() * 12);
            const d = Math.floor(Math.random() * 28) + 1;
            const hour = Math.floor(Math.random() * 24);
            
            // Dátum és Nap
            const dateObj = new Date(2023, m, d, hour);
            const dateStr = dateObj.toISOString().split('T')[0];
            const dayName = days[dateObj.getDay() === 0 ? 6 : dateObj.getDay() - 1]; // JS: 0=Vasárnap

            const dept = depts[Math.floor(Math.random() * depts.length)];
            let type = types[Math.floor(Math.random() * types.length)];
            let severity = "Low";
            let cost = Math.floor(Math.random() * 5000) + 500;

            // SZTORI LOGIKA
            // 1. Munkaidő sűrűsítése a heatmaphez
            let finalHour = hour;
            if (Math.random() > 0.4) {
                finalHour = Math.floor(Math.random() * (16 - 9 + 1)) + 9; // 09:00 - 16:00
            }

            // 2. Finance = Drága
            if (dept === 'Finance' && Math.random() > 0.5) { 
                type = 'Ransomware'; 
                severity = 'Critical';
                cost *= 8;
            }

            dataPoints.push({
                date: dateStr,
                department: dept,
                type: type,
                severity: severity,
                cost: cost,
                day: dayName,
                hour: finalHour
            });
        }

        // --- DARK THEME KONFIGURÁCIÓ (Hogy ne legyen fehér doboz) ---
        const darkConfig = {
            "background": "transparent", // Átlátszó háttér
            "view": {"stroke": "transparent"},
            "title": {"color": "#fff", "fontSize": 16},
            "style": {"guide-label": {"fill": "#94a3b8"}, "guide-title": {"fill": "#fff"}},
            "axis": {
                "domainColor": "#334155", 
                "gridColor": "#334155", 
                "tickColor": "#334155", 
                "labelColor": "#94a3b8", 
                "titleColor": "#f8fafc"
            },
            "legend": {
                "labelColor": "#94a3b8", 
                "titleColor": "#fff"
            }
        };

        // --- 1. MAIN DASHBOARD SPEC ---
        const mainSpec = {
            "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
            "data": { "values": dataPoints },
            "config": darkConfig,
            "width": "container", // Reszponzív szélesség
            "vconcat": [
                {
                    // SCATTER PLOT
                    "height": 250,
                    "title": "Idővonal és Költségek (Interaktív Szűrő: Húzzon sávot!)",
                    "mark": "circle",
                    "selection": {"brush": {"type": "interval", "encodings": ["x"]}},
                    "encoding": {
                        "x": {"field": "date", "type": "temporal", "title": "Dátum"},
                        "y": {"field": "cost", "type": "quantitative", "title": "Kár ($)"},
                        "color": {
                            "field": "severity",
                            "scale": {"domain": ["Low", "Medium", "High", "Critical"], "range": ["#10b981", "#f59e0b", "#f97316", "#ef4444"]},
                            "legend": {"title": "Súlyosság"}
                        },
                        "size": {"value": 60},
                        "tooltip": [{"field": "department"}, {"field": "cost"}]
                    }
                },
                {
                    "columns": 2, // Két oszlopba rendezi az alsókat
                    "resolve": {"scale": {"color": "independent"}},
                    "hconcat": [
                        {
                            // BAR CHART
                            "width": 400, "height": 250, 
                            "title": "Támadási Típusok (Szűrt)",
                            "transform": [{"filter": {"selection": "brush"}}],
                            "mark": {"type": "bar", "cornerRadiusEnd": 4},
                            "encoding": {
                                "y": {"field": "type", "type": "nominal", "title": null, "sort": "-x"},
                                "x": {"aggregate": "count", "title": "Esetszám"},
                                "color": {"value": "#38bdf8"} // Neon Blue
                            }
                        },
                        {
                            // DONUT CHART
                            "width": 400, "height": 250, 
                            "title": "Érintett Részlegek (Szűrt)",
                            "transform": [{"filter": {"selection": "brush"}}],
                            "mark": {"type": "arc", "innerRadius": 60},
                            "encoding": {
                                "theta": {"aggregate": "count", "field": "department"},
                                "color": {
                                    "field": "department", 
                                    "scale": {"scheme": "category10"},
                                    "legend": {"title": "Részleg"}
                                },
                                "tooltip": [{"field": "department"}, {"aggregate": "count"}]
                            }
                        }
                    ]
                }
            ]
        };

        // --- 2. HEATMAP SPEC ---
        const heatSpec = {
            "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
            "data": { "values": dataPoints },
            "config": darkConfig,
            "width": "container",
            "height": 300,
            "title": "Támadási Intenzitás (Nap vs Óra)",
            "mark": "rect",
            "encoding": {
                "x": {"field": "hour", "type": "ordinal", "title": "Óra (00-23)"},
                "y": {
                    "field": "day", 
                    "type": "nominal", 
                    "title": null, 
                    "sort": ["Hétfő", "Kedd", "Szerda", "Csütörtök", "Péntek", "Szombat", "Vasárnap"]
                },
                "color": {
                    "aggregate": "count",
                    "title": "Incidensek",
                    "scale": {"scheme": "inferno"} // Drámai színek (fekete->narancs->sárga)
                },
                "tooltip": [
                    {"field": "day", "title": "Nap"},
                    {"field": "hour", "title": "Óra"},
                    {"aggregate": "count", "title": "Darab"}
                ]
            }
        };

        // --- RENDER ---
        // Fontos: a theme 'null' legyen, hogy a saját configunk érvényesüljön
        vegaEmbed('#viz-main', mainSpec, {actions: false}).catch(console.error);
        vegaEmbed('#viz-heatmap', heatSpec, {actions: false}).catch(console.error);

    </script>
</body>
</html>
